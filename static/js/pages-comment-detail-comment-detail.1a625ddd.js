(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["pages-comment-detail-comment-detail"],{1234:function(t,e,n){"use strict";n("7a82");var i=n("4ea4").default;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var o=i(n("c7eb")),a=i(n("1da1")),r=n("7a0d"),c=n("cd5d"),u={name:"comment",props:{item:{type:Object,default:function(){return{}}},type:{type:String,default:"top"}},data:function(){return{ifShowCommentGroup:!0,likeControl:""}},created:function(){},computed:{hasLogin:function(){return r.store.hasLogin},userInfo:function(){return r.store.userInfo}},methods:{getName:c.getName,getAvatar:c.getAvatar,onLikeComment:function(){var t=this;return(0,a.default)((0,o.default)().mark((function e(){var n;return(0,o.default)().wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(!t.hasLogin){e.next=11;break}if(n=Date.now(),!(n-t.likeControl<1e3)){e.next=5;break}return uni.showToast({title:"请勿频繁点击",icon:"none"}),e.abrupt("return");case 5:t.likeControl=n,t.item.ifLiked?t.item.like_count--:t.item.like_count++,t.item.ifLiked=!t.item.ifLiked,(0,c.handleLikeComment)(t.item._id),e.next=12;break;case 11:(0,c.needAuth)();case 12:"top"==t.type&&uni.setStorageSync("commentItem",t.item);case 13:case"end":return e.stop()}}),e)})))()},goUserProfile:function(){uni.navigateTo({url:"/pages/user-profile/user-profile?id="+this.item.user_id[0]._id})},goCommentDetail:function(){"top"==this.type&&(uni.setStorageSync("commentItem",this.item),uni.navigateTo({url:"/pages/comment-detail/comment-detail"}))}}};e.default=u},"1aa7":function(t,e,n){"use strict";n.d(e,"b",(function(){return o})),n.d(e,"c",(function(){return a})),n.d(e,"a",(function(){return i}));var i={uniDateformat:n("453e").default},o=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("v-uni-view",{staticClass:"comment-item",style:{backgroundColor:"top"==t.type?"#fff":"transparent",borderBottom:"top"==t.type?"none":"2rpx solid #eee"},on:{click:function(e){arguments[0]=e=t.$handleEvent(e),t.goCommentDetail.apply(void 0,arguments)}}},[n("v-uni-view",{staticClass:"avatar",on:{click:function(e){e.stopPropagation(),arguments[0]=e=t.$handleEvent(e),t.goUserProfile.apply(void 0,arguments)}}},[n("v-uni-image",{attrs:{src:t.getAvatar(t.item),mode:"aspectFill"}})],1),n("v-uni-view",{staticClass:"main"},[n("v-uni-view",{staticClass:"name"},[t._v(t._s(t.getName(t.item)))]),n("v-uni-view",{staticClass:"cont"},[t._v(t._s(t.item.comment_content))]),n("v-uni-view",{staticClass:"info"},[n("uni-dateformat",{attrs:{date:t.item.comment_date,threshold:[18e4,864e5],format:"MM/dd"}}),n("v-uni-text",{staticClass:"loc"},[t._v(t._s(t.item.province||"IP未知"))]),n("v-uni-view",{staticClass:"ope"},[0==t.item.comment_type?n("v-uni-view",{staticClass:"comment-group"},[n("v-uni-text",{staticClass:"iconfont icon-message"}),n("v-uni-text",{staticClass:"comment-count"},[t._v(t._s(t.item.reply_count||0))])],1):t._e(),n("v-uni-view",{staticClass:"like-group",class:t.item.ifLiked?"active":""},[n("v-uni-text",{staticClass:"iconfont icon-good",on:{click:function(e){e.stopPropagation(),arguments[0]=e=t.$handleEvent(e),t.onLikeComment.apply(void 0,arguments)}}}),n("v-uni-text",{staticClass:"like-count"},[t._v(t._s(t.item.like_count||"点赞"))])],1)],1)],1)],1)],1)},a=[]},"35c1":function(t,e,n){"use strict";n.d(e,"b",(function(){return o})),n.d(e,"c",(function(){return a})),n.d(e,"a",(function(){return i}));var i={comment:n("e924").default,uEmpty:n("f697").default,commentBox:n("ddf4").default,uLoadingIcon:n("7dfc").default},o=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("v-uni-view",{staticClass:"comment-detail"},[n("v-uni-view",{staticClass:"top"},[n("comment",{attrs:{item:t.commentItem,type:"top"}})],1),t.loading?n("u-loading-icon",{attrs:{text:"加载中",textSize:"14"}}):[t.commentList.length?n("v-uni-view",{staticClass:"list"},t._l(t.commentList,(function(t){return n("comment",{key:t._id,attrs:{item:t,type:"second"}})})),1):n("v-uni-view",{staticClass:"list"},[n("u-empty",{attrs:{text:"暂无回复",mode:"comment",icon:"http://cdn.uviewui.com/uview/empty/comment.png"}})],1),n("comment-box",{attrs:{article_id:t.commentItem.article_id,comment_type:t.comment_type,reply_comment_id:t.commentItem._id},on:{refreshCommentList:function(e){arguments[0]=e=t.$handleEvent(e),t.refreshCommentList.apply(void 0,arguments)}}})]],2)},a=[]},4021:function(t,e,n){var i=n("5512");i.__esModule&&(i=i.default),"string"===typeof i&&(i=[[t.i,i,""]]),i.locals&&(t.exports=i.locals);var o=n("4f06").default;o("658ab704",i,!0,{sourceMap:!1,shadowMode:!1})},"4ae7":function(t,e,n){"use strict";var i=n("fdc1"),o=n.n(i);o.a},5512:function(t,e,n){var i=n("24fb");e=i(!1),e.push([t.i,'@charset "UTF-8";\r\n/**\r\n * 这里是uni-app内置的常用样式变量\r\n *\r\n * uni-app 官方扩展插件及插件市场（https://ext.dcloud.net.cn）上很多三方插件均使用了这些样式变量\r\n * 如果你是插件开发者，建议你使用scss预处理，并在插件代码中直接使用这些变量（无需 import 这个文件），方便用户通过搭积木的方式开发整体风格一致的App\r\n *\r\n */\r\n/**\r\n * 如果你是App开发者（插件使用者），你可以通过修改这些变量来定制自己的插件主题，实现自定义主题功能\r\n *\r\n * 如果你的项目同样使用了scss预处理，你也可以直接在你的 scss 代码中使用如下变量，同时无需 import 这个文件\r\n */\r\n/* 颜色变量 */\r\n/* 行为相关颜色 */\r\n/* 文字基本颜色 */\r\n/* 背景颜色 */\r\n/* 边框颜色 */\r\n/* 尺寸变量 */\r\n/* 文字尺寸 */\r\n/* 图片尺寸 */\r\n/* Border Radius */\r\n/* 水平间距 */\r\n/* 垂直间距 */\r\n/* 透明度 */\r\n/* 文章场景相关 */.comment-box[data-v-379d40da]{width:100%;background:#fff;padding:%?20?% %?30?%;box-sizing:border-box;position:fixed;bottom:0;left:0;z-index:100;height:%?112?%;background-color:initial}',""]),t.exports=e},6998:function(t,e,n){"use strict";(function(t){n("7a82");var i=n("4ea4").default;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0,n("d81d"),n("d3b7"),n("159b"),n("c740"),n("99af");var o=i(n("c7eb")),a=i(n("1da1")),r=n("7a0d"),c=t.database(),u={data:function(){return{commentItem:{},commentList:[],comment_type:1,loading:!0}},computed:{hasLogin:function(){return r.store.hasLogin},userInfo:function(){return r.store.userInfo}},onLoad:function(){var t=uni.getStorageSync("commentItem");this.commentItem=t,this.getComment()},methods:{refreshCommentList:function(){this.getComment(),this.commentItem.reply_count++,uni.setStorageSync("commentItem",this.commentItem)},userIfLiked:function(){var e=this;return(0,a.default)((0,o.default)().mark((function n(){var i,a;return(0,o.default)().wrap((function(n){while(1)switch(n.prev=n.next){case 0:return i=e.commentList.map((function(t){return t._id})),n.next=3,c.collection("quanzi_like_comment").where({comment_id:c.command.in(i),user_id:t.getCurrentUserInfo().uid}).get();case 3:a=n.sent,e.commentList.forEach((function(t){var n=a.result.data.findIndex((function(e){return e.comment_id==t._id}));n>-1?e.$set(t,"ifLiked",!0):e.$set(t,"ifLiked",!1)})),console.log("this.commentList::::: ",e.commentList);case 6:case"end":return n.stop()}}),n)})))()},getComment:function(){var t=this;return(0,a.default)((0,o.default)().mark((function e(){var n,i,a;return(0,o.default)().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return n=c.collection("quanzi-comment").where("article_id == '".concat(t.commentItem.article_id,"' && comment_type == 1 && reply_comment_id == '").concat(t.commentItem._id,"'")).orderBy("comment_date desc").limit(10).getTemp(),i=c.collection("uni-id-users").field("_id,username,nickname,avatar_file,province").getTemp(),e.next=4,c.collection(n,i).get();case 4:a=e.sent,t.commentList=a.result.data,t.loading=!1,t.hasLogin&&t.userIfLiked();case 8:case"end":return e.stop()}}),e)})))()}}};e.default=u}).call(this,n("a9ff")["default"])},"7d45":function(t,e,n){"use strict";var i=n("4021"),o=n.n(i);o.a},9146:function(t,e,n){var i=n("ffb4");i.__esModule&&(i=i.default),"string"===typeof i&&(i=[[t.i,i,""]]),i.locals&&(t.exports=i.locals);var o=n("4f06").default;o("8cb3e002",i,!0,{sourceMap:!1,shadowMode:!1})},a2f0:function(t,e,n){"use strict";n.r(e);var i=n("1234"),o=n.n(i);for(var a in i)["default"].indexOf(a)<0&&function(t){n.d(e,t,(function(){return i[t]}))}(a);e["default"]=o.a},ab0e:function(t,e,n){"use strict";(function(t){n("7a82"),Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0,n("a9e3");var i=n("7a0d"),o=n("cd5d"),a=t.database(),r=t.importObject("utils"),c=r.countUpdate,u={name:"comment-box",props:{article_id:{type:String},comment_type:{type:Number,default:0},reply_comment_id:{type:String,default:""}},created:function(){var t=this;(0,o.getIp)().then((function(e){t.query.province=e.province}))},computed:{hasLogin:function(){return i.store.hasLogin},userInfo:function(){return i.store.userInfo}},data:function(){return{query:{article_id:"",user_id:"",comment_content:"",comment_type:0,reply_comment_id:"",province:""}}},methods:{onAddComment:function(){this.hasLogin?this.addComment():(0,o.needAuth)()},iconClick:function(){this.hasLogin?this.addComment():(0,o.needAuth)()},addComment:function(){var e=this;this.query.user_id=t.getCurrentUserInfo().uid,this.query.article_id=this.article_id,this.query.comment_type=this.comment_type,this.query.comment_type&&(this.query.reply_comment_id=this.reply_comment_id),a.collection("quanzi-comment").add(this.query).then((function(t){console.log("addComment: ",t),t.result.id&&(uni.showToast({title:"评论成功",icon:"none"}),e.query.comment_type?c("quanzi-comment",e.query.reply_comment_id,"reply_count",1):c("quanzi-article",e.query.article_id,"comment_count",1),e.$emit("refreshCommentList"),e.query.comment_content="")}))}}};e.default=u}).call(this,n("a9ff")["default"])},bdf3:function(t,e,n){"use strict";n.r(e);var i=n("6998"),o=n.n(i);for(var a in i)["default"].indexOf(a)<0&&function(t){n.d(e,t,(function(){return i[t]}))}(a);e["default"]=o.a},c1d0:function(t,e,n){"use strict";n.r(e);var i=n("ab0e"),o=n.n(i);for(var a in i)["default"].indexOf(a)<0&&function(t){n.d(e,t,(function(){return i[t]}))}(a);e["default"]=o.a},c339:function(t,e,n){var i=n("24fb");e=i(!1),e.push([t.i,'@charset "UTF-8";\r\n/**\r\n * 这里是uni-app内置的常用样式变量\r\n *\r\n * uni-app 官方扩展插件及插件市场（https://ext.dcloud.net.cn）上很多三方插件均使用了这些样式变量\r\n * 如果你是插件开发者，建议你使用scss预处理，并在插件代码中直接使用这些变量（无需 import 这个文件），方便用户通过搭积木的方式开发整体风格一致的App\r\n *\r\n */\r\n/**\r\n * 如果你是App开发者（插件使用者），你可以通过修改这些变量来定制自己的插件主题，实现自定义主题功能\r\n *\r\n * 如果你的项目同样使用了scss预处理，你也可以直接在你的 scss 代码中使用如下变量，同时无需 import 这个文件\r\n */\r\n/* 颜色变量 */\r\n/* 行为相关颜色 */\r\n/* 文字基本颜色 */\r\n/* 背景颜色 */\r\n/* 边框颜色 */\r\n/* 尺寸变量 */\r\n/* 文字尺寸 */\r\n/* 图片尺寸 */\r\n/* Border Radius */\r\n/* 水平间距 */\r\n/* 垂直间距 */\r\n/* 透明度 */\r\n/* 文章场景相关 */.comment-item[data-v-121f73c4]{display:flex;border-bottom:%?2?% solid #eee;padding:%?20?% 0;height:%?200?%;box-sizing:border-box}.comment-item .avatar[data-v-121f73c4]{margin-right:%?18?%}.comment-item .avatar uni-image[data-v-121f73c4]{width:%?60?%;height:%?60?%;border-radius:50%}.comment-item .main[data-v-121f73c4]{flex:1}.comment-item .main .name[data-v-121f73c4]{color:#666;font-size:%?26?%}.comment-item .main .cont[data-v-121f73c4]{color:#333;font-size:%?28?%;margin:%?10?% 0}.comment-item .main .info[data-v-121f73c4]{color:#999;font-size:%?22?%;display:flex;align-items:center}.comment-item .main .info .loc[data-v-121f73c4]{margin-left:%?10?%}.comment-item .main .info .ope[data-v-121f73c4]{margin-left:auto;display:flex;align-items:center;justify-content:end;width:%?200?%}.comment-item .main .info .ope .comment-group[data-v-121f73c4]{margin-right:%?40?%;display:flex;align-items:center}.comment-item .main .info .ope .comment-group .comment-count[data-v-121f73c4]{margin-left:%?6?%}.comment-item .main .info .ope .like-group[data-v-121f73c4]{color:#999aaa;display:flex;align-items:center}.comment-item .main .info .ope .like-group .like-count[data-v-121f73c4]{margin:0 %?10?%}.comment-item .main .info .ope .like-group.active[data-v-121f73c4]{color:#fc5531}',""]),t.exports=e},ddf4:function(t,e,n){"use strict";n.r(e);var i=n("f4db"),o=n("c1d0");for(var a in o)["default"].indexOf(a)<0&&function(t){n.d(e,t,(function(){return o[t]}))}(a);n("7d45");var r=n("f0c5"),c=Object(r["a"])(o["default"],i["b"],i["c"],!1,null,"379d40da",null,!1,i["a"],void 0);e["default"]=c.exports},de33:function(t,e,n){"use strict";n.r(e);var i=n("35c1"),o=n("bdf3");for(var a in o)["default"].indexOf(a)<0&&function(t){n.d(e,t,(function(){return o[t]}))}(a);n("ef4d");var r=n("f0c5"),c=Object(r["a"])(o["default"],i["b"],i["c"],!1,null,"cea23f52",null,!1,i["a"],void 0);e["default"]=c.exports},e924:function(t,e,n){"use strict";n.r(e);var i=n("1aa7"),o=n("a2f0");for(var a in o)["default"].indexOf(a)<0&&function(t){n.d(e,t,(function(){return o[t]}))}(a);n("4ae7");var r=n("f0c5"),c=Object(r["a"])(o["default"],i["b"],i["c"],!1,null,"121f73c4",null,!1,i["a"],void 0);e["default"]=c.exports},ef4d:function(t,e,n){"use strict";var i=n("9146"),o=n.n(i);o.a},f4db:function(t,e,n){"use strict";n.d(e,"b",(function(){return o})),n.d(e,"c",(function(){return a})),n.d(e,"a",(function(){return i}));var i={uniEasyinput:n("ef0a").default},o=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("v-uni-view",{staticClass:"comment-box"},[n("uni-easyinput",{attrs:{type:"text",suffixIcon:"paperplane",placeholder:"评论点什么吧~",trim:!0},on:{confirm:function(e){arguments[0]=e=t.$handleEvent(e),t.onAddComment.apply(void 0,arguments)},iconClick:function(e){arguments[0]=e=t.$handleEvent(e),t.iconClick.apply(void 0,arguments)}},model:{value:t.query.comment_content,callback:function(e){t.$set(t.query,"comment_content",e)},expression:"query.comment_content"}})],1)},a=[]},fdc1:function(t,e,n){var i=n("c339");i.__esModule&&(i=i.default),"string"===typeof i&&(i=[[t.i,i,""]]),i.locals&&(t.exports=i.locals);var o=n("4f06").default;o("330e3161",i,!0,{sourceMap:!1,shadowMode:!1})},ffb4:function(t,e,n){var i=n("24fb");e=i(!1),e.push([t.i,'@charset "UTF-8";\r\n/**\r\n * 这里是uni-app内置的常用样式变量\r\n *\r\n * uni-app 官方扩展插件及插件市场（https://ext.dcloud.net.cn）上很多三方插件均使用了这些样式变量\r\n * 如果你是插件开发者，建议你使用scss预处理，并在插件代码中直接使用这些变量（无需 import 这个文件），方便用户通过搭积木的方式开发整体风格一致的App\r\n *\r\n */\r\n/**\r\n * 如果你是App开发者（插件使用者），你可以通过修改这些变量来定制自己的插件主题，实现自定义主题功能\r\n *\r\n * 如果你的项目同样使用了scss预处理，你也可以直接在你的 scss 代码中使用如下变量，同时无需 import 这个文件\r\n */\r\n/* 颜色变量 */\r\n/* 行为相关颜色 */\r\n/* 文字基本颜色 */\r\n/* 背景颜色 */\r\n/* 边框颜色 */\r\n/* 尺寸变量 */\r\n/* 文字尺寸 */\r\n/* 图片尺寸 */\r\n/* Border Radius */\r\n/* 水平间距 */\r\n/* 垂直间距 */\r\n/* 透明度 */\r\n/* 文章场景相关 */.comment-detail .top[data-v-cea23f52]{padding:0 %?30?%}.comment-detail .list[data-v-cea23f52]{padding:%?30?%;background-color:#f8f8f8;min-height:calc(100vh - %?400?%)}',""]),t.exports=e}}]);